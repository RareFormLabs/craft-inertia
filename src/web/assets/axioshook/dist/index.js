(function(c){typeof define=="function"&&define.amd?define(c):c()})(function(){"use strict";const c="/actions/users/session-info",d=async function(){return await fetch(c,{headers:{Accept:"application/json"}}).then(t=>t.json())};let s=null;const m=t=>{const e=new URL(t).pathname,o=window.location.pathname.split("/");o.pop();const r=o.join("/");return e.replace(r,"").replace(/^\//,"")},h=()=>{const t=document.head.querySelector("meta[csrf]");if(!t)return null;const n=t==null?void 0:t.getAttribute("name"),e=t==null?void 0:t.getAttribute("content");return{csrfTokenName:n??"CRAFT_CSRF_TOKEN",csrfTokenValue:e??""}},f=(t,n)=>{let e=document.head.querySelector("meta[csrf]");e?(e.setAttribute("name",t),e.setAttribute("content",n)):(e=document.createElement("meta"),e.setAttribute("csrf",""),e.setAttribute("name",t),e.setAttribute("content",n),document.head.appendChild(e))},T=async()=>{window.axios.defaults.headers={"Content-Type":"multipart/form-data"},window.axios.interceptors.request.use(async t=>{if(t.method==="post"||t.method==="put"){let n=h();n||(s=await d(),s.isGuest||(f(s.csrfTokenName,s.csrfTokenValue),n=h()));const e=n||s;if(!e)throw new Error("CSRF token not found");const o=m(t.url);if(t.url="",t.data instanceof FormData)t.data.append(e.csrfTokenName,e.csrfTokenValue),t.data.append("action",o);else{const r=a=>Array.isArray(a)?a.map(l=>r(l)):typeof a=="object"&&a!==null?Object.fromEntries(Object.entries(a).map(([l,p])=>[l,Array.isArray(p)&&p.length===0?"":r(p)])):a,u=t.headers["Content-Type"]||t.headers["content-type"]||t.headers["CONTENT-TYPE"];let i={[e.csrfTokenName]:e.csrfTokenValue,action:o,...t.data};typeof u=="string"&&u.toLowerCase().includes("multipart/form-data")&&(i=r(i)),t.data=i}}return t}),window.axios.interceptors.response.use(async t=>{var n;return((n=t.config.data)==null?void 0:n.get("action"))=="users/login"&&await d().then(e=>{f(e.csrfTokenName,e.csrfTokenValue)}),t})};(async()=>{let n=0;const e=setInterval(async()=>{if(window.axios){clearInterval(e),await T();return}n++,n>=40&&(clearInterval(e),console.warn("Inertia (Craft): Axios not found after 10 seconds. CSRF protection may not be active."))},250)})()});
