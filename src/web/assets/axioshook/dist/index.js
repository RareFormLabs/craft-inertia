(function(o){typeof define=="function"&&define.amd?define(o):o()})(function(){"use strict";const o="/actions/users/session-info",u=async function(){return await fetch(o,{headers:{Accept:"application/json"}}).then(t=>t.json())};let s=null;const p=t=>{const e=new URL(t).pathname,r=window.location.pathname.split("/");r.pop();const a=r.join("/");return e.replace(a,"").replace(/^\//,"")},f=()=>{const t=document.head.querySelector("meta[csrf]");if(!t)return null;const n=t==null?void 0:t.getAttribute("name"),e=t==null?void 0:t.getAttribute("content");return{csrfTokenName:n??"CRAFT_CSRF_TOKEN",csrfTokenValue:e??""}},i=(t,n=10,e=0)=>e>n?t:Array.isArray(t)?t.map(r=>i(r,n,e+1)):typeof t=="object"&&t!==null?Object.fromEntries(Object.entries(t).map(([r,a])=>[r,Array.isArray(a)&&a.length===0?"":i(a,n,e+1)])):t,l=t=>{if(typeof t.get=="function")return t.get("content-type");for(const n in t)if(n.toLowerCase()==="content-type")return t[n]},d=(t,n)=>{let e=document.head.querySelector("meta[csrf]");e?(e.setAttribute("name",t),e.setAttribute("content",n)):(e=document.createElement("meta"),e.setAttribute("csrf",""),e.setAttribute("name",t),e.setAttribute("content",n),document.head.appendChild(e))},m=(t,n)=>{if(t instanceof FormData)return t.get(n);if(typeof t=="object"&&t!==null)return t[n];if(typeof t=="string")try{const e=JSON.parse(t);if(typeof e=="object"&&e!==null)return e[n]}catch{return new URLSearchParams(t).get(n)}},h=async()=>{window.axios.interceptors.request.use(async t=>{if(t.method!=="post"&&t.method!=="put")return t;let n=f();n||(s=await u(),s.isGuest||(d(s.csrfTokenName,s.csrfTokenValue),n=f()));const e=n||s;if(!e)throw new Error("Inertia (Craft): CSRF token not found. Ensure session is initialized or meta tag is present.");const r=p(t.url??"");if(l(t.headers)==null&&t.headers.set("Content-Type","application/x-www-form-urlencoded"),t.data instanceof FormData)t.data.has("action")||(t.data.append("action",r),t.url=""),t.data.append(e.csrfTokenName,e.csrfTokenValue);else{let a={[e.csrfTokenName]:e.csrfTokenValue,action:r,...t.data};const c=l(t.headers??{});typeof c=="string"&&c.toLowerCase().includes("multipart/form-data")&&(a=i(a)),t.data=a}return t}),window.axios.interceptors.response.use(async t=>{let n=null;if(t.config.data instanceof FormData)n=t.config.data.get("action");else if(typeof t.config.data=="object"&&t.config.data!==null)n=t.config.data.action;else if(typeof t.config.data=="string")try{n=JSON.parse(t.config.data).action}catch{n=new URLSearchParams(t.config.data).get("action")}let e=!1;return n&&["users/login","users/set-password"].includes(n)?e=!0:n&&n=="users/save-user"&&(m(t.config.data,"userId")||(e=!0)),e&&await u().then(a=>{d(a.csrfTokenName,a.csrfTokenValue)}),t})};(async()=>{let n=0;const e=setInterval(async()=>{if(window.axios){clearInterval(e),await h(),console.log("Inertia (Craft): Axios configured successfully.");return}n++,n>=40&&(clearInterval(e),console.warn("Inertia (Craft): Axios not found after 10 seconds. CSRF protection may not be active."))},250)})()});
